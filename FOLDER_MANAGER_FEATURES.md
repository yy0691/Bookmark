# 文件夹可视化管理功能说明

## 新增功能

### 1. 书签和文件夹管理
- ✅ **添加书签**: 点击顶部"添加书签"按钮，可以向选中的文件夹添加新书签
- ✅ **添加文件夹**: 点击顶部"添加文件夹"按钮，可以在选中的文件夹下创建新文件夹
- ✅ **编辑**: 选中书签或文件夹后，点击"编辑"按钮可以修改标题和URL（书签）或名称（文件夹）
- ✅ **删除**: 选中书签或文件夹后，点击"删除"按钮可以删除该项目
  - 删除文件夹时会提示包含的项目数量
  - 删除操作需要确认，防止误删

### 2. 拖拽功能
- ✅ **拖拽移动**: 所有书签和文件夹都支持拖拽
- ✅ **调整层级**: 可以将书签或文件夹拖到其他文件夹中（拖到文件夹的中间区域）
- ✅ **调整顺序**: 可以在同一层级中调整书签和文件夹的顺序
  - 拖到项目的上方：插入到该项目之前
  - 拖到项目的下方：插入到该项目之后
  - 拖到文件夹的中间：移动到该文件夹内
- ✅ **智能提示**: 
  - 拖到上方时显示蓝色上边框
  - 拖到下方时显示蓝色下边框
  - 拖到文件夹中间时高亮整个文件夹
- ✅ **错误防护**: 
  - 不能将文件夹拖到自己或子文件夹中
  - 显示友好的错误提示

### 3. 主题同步
- ✅ **自动同步**: 主题设置与 index 页面保持一致
- ✅ **实时更新**: 当在 index 页面更改主题时，文件夹管理器会自动更新
- ✅ **支持的主题**: 深色模式、浅色模式、自动模式
- ✅ **支持的强调色**: 蓝色、紫色、绿色、橙色、红色、粉色

### 4. 增强的可视化
- ✅ **书签显示**: 现在树形结构中也会显示书签（使用 🔖 图标）
- ✅ **详细信息**: 点击书签可以查看URL和其他详细信息
- ✅ **书签可视化**: 右侧面板显示书签的URL，可以直接点击打开

### 5. 用户体验改进
- ✅ **Toast 通知**: 所有操作都会显示友好的成功或错误提示
- ✅ **模态框**: 添加和编辑使用漂亮的模态框界面
- ✅ **键盘支持**: 在模态框中按 Enter 键保存，ESC 键取消
- ✅ **响应式设计**: 界面适配不同屏幕尺寸

## 使用方法

### 添加书签或文件夹
1. 在左侧树形结构中选择一个文件夹（作为父文件夹）
2. 点击顶部的"添加书签"或"添加文件夹"按钮
3. 在弹出的模态框中输入信息
4. 点击"保存"或按 Enter 键

### 编辑书签或文件夹
1. 在左侧树形结构中选择要编辑的项目
2. 点击右侧的"编辑"按钮
3. 修改信息后点击"保存"

### 删除书签或文件夹
1. 在左侧树形结构中选择要删除的项目
2. 点击右侧的"删除"按钮
3. 确认删除操作

### 拖拽移动
1. 在左侧树形结构中，按住要移动的书签或文件夹
2. 拖动到目标位置：
   - **调整顺序**: 拖到其他项目的上方或下方，会看到蓝色的指示线
   - **改变层级**: 拖到文件夹的中间区域，文件夹会高亮显示
3. 松开鼠标完成移动

## 技术实现

### 主题同步机制
```javascript
// 从 chrome.storage 加载主题设置
const result = await chrome.storage.local.get('newtabSettings');
const theme = result.newtabSettings.theme;
const accent = result.newtabSettings.accentColor;

// 应用主题
document.documentElement.setAttribute('data-theme', theme);
document.documentElement.setAttribute('data-accent', accent);

// 监听主题变化
chrome.storage.onChanged.addListener((changes) => {
  // 自动更新主题
});
```

### 拖拽实现
- 使用 HTML5 Drag and Drop API
- 根据鼠标位置智能判断拖拽意图：
  - 文件夹：上方25%=前插入，下方25%=后插入，中间50%=移入
  - 书签：上方50%=前插入，下方50%=后插入
- 计算正确的插入位置索引
- 使用 Chrome Bookmarks API 移动项目（支持 index 参数调整顺序）
- 自动刷新树形结构并保持选中状态

### Chrome API 使用
- `chrome.bookmarks.create()`: 创建书签/文件夹
- `chrome.bookmarks.update()`: 更新书签/文件夹
- `chrome.bookmarks.remove()`: 删除书签
- `chrome.bookmarks.removeTree()`: 删除文件夹及其内容
- `chrome.bookmarks.move()`: 移动书签/文件夹
- `chrome.storage.local`: 存储和同步设置

## 注意事项

1. **系统文件夹保护**: 无法删除浏览器的系统文件夹（如"书签栏"、"其他书签"等）
2. **批量操作**: 目前不支持多选，一次只能操作一个项目
3. **撤销功能**: 删除操作无法撤销，请谨慎操作
4. **性能考虑**: 大量书签时，拖拽操作可能会有轻微延迟

## 未来改进

- [ ] 支持多选批量操作
- [ ] 添加撤销/重做功能
- [ ] 支持键盘快捷键（如 Delete 键删除、Ctrl+C/V 复制粘贴）
- [ ] 添加搜索和过滤功能
- [ ] 添加导入功能（从JSON/HTML文件）
- [ ] 支持右键菜单快捷操作
- [ ] 添加书签预览（显示网站缩略图）
- [ ] 支持批量编辑标签
