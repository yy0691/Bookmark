# Nextab-style Refactor & Optimization Plan (MV3-ready)

## M1 è„šæ‰‹æ¶ä¸åˆ‡æ¢ï¼ˆå·²å®Œæˆï¼‰
- æ–°å»º `pages/newtab/index.html`ã€`pages/newtab/newtab.css`ã€`pages/newtab/newtab.js`ï¼Œç§»é™¤å†…è” JS/CSS ä¸è¿œç¨‹å­—ä½“ã€‚
- ä½¿ç”¨æœ¬åœ° `lucide.min.js`ã€‚
- åŸºç¡€äº¤äº’ï¼šæ—¶é’Ÿã€Ctrl/Cmd+K èšç„¦ã€è§†å›¾åˆ‡æ¢ã€ç¬”è®°è‡ªåŠ¨ä¿å­˜ï¼ˆ`chrome.storage.local`ï¼‰ã€‚
- `manifest.json` å°† `chrome_url_overrides.newtab` æŒ‡å‘ `pages/newtab/index.html`ã€‚

---

## M2 æ•°æ®æ¥å…¥ä¸åŠŸèƒ½æ‰“é€šï¼ˆè¿›è¡Œä¸­ï¼‰
ç›®æ ‡ï¼šNextab é¡µæ˜¾ç¤ºçœŸå®ä¹¦ç­¾æ•°æ®å¹¶ä¸æœåŠ¡æ¨¡å—è¿é€šã€‚

- ä»»åŠ¡
  - æ¥å…¥ `modules/bookmarkService.js`ï¼š
    - åŠ è½½ä¹¦ç­¾æ ‘ â†’ æ¸²æŸ“ `#folder-list`ï¼ˆåç§°ã€è®¡æ•°ã€é€‰ä¸­æ€ï¼‰ã€‚
    - åŠ è½½æœ€è¿‘ä¹¦ç­¾ä¸æŒ‰æ–‡ä»¶å¤¹è¿‡æ»¤ â†’ æ¸²æŸ“ `#bookmarks-grid`ã€‚
    - æœç´¢ï¼ˆ200ms é˜²æŠ–ï¼‰ã€‚
    - è®¢é˜…æ–°å¢/åˆ é™¤/ç§»åŠ¨äº‹ä»¶å¹¶å¢é‡åˆ·æ–°ã€‚
  - æ¥å…¥/é€‚é… `modules/visualizationService.js`ï¼š
    - çº¯æ¸²æŸ“å…¥å£ï¼š`render(container, items, { view: 'grid' | 'list' })`ã€‚
    - favicon ç­–ç•¥ï¼šä¼˜å…ˆ `chrome://favicon/size/32@2x/<url>` æˆ–å»¶è¿ŸæŒ‰éœ€åŠ è½½ã€‚
  - ç»Ÿä¸€åŠ è½½æ€/ç©ºçŠ¶æ€/é”™è¯¯æ€ UIã€‚
- å—å½±å“æ–‡ä»¶
  - `pages/newtab/newtab.js`
  - `modules/visualizationService.js`
  - `modules/bookmarkService.js`
- éªŒæ”¶æ ‡å‡†
  - æ–°æ ‡ç­¾é¡µèƒ½æ˜¾ç¤ºçœŸå®æ•°æ®ï¼Œå¯æœç´¢ã€å¯åˆ‡æ¢æ–‡ä»¶å¤¹ã€‚
  - ä¹¦ç­¾å˜æ›´è§¦å‘ UI æ›´æ–°ã€‚
  - æ—  CSP/å¤–é“¾è­¦å‘Šã€‚

---

## M3 è§†å›¾å®Œå–„ä¸æ€§èƒ½ä¼˜åŒ–
ç›®æ ‡ï¼š1kâ€“5k ä¹¦ç­¾ä¸å¡é¡¿ã€äº¤äº’æµç•…ã€‚

- ä»»åŠ¡
  - è™šæ‹Ÿåˆ—è¡¨/çª—å£åŒ–æ¸²æŸ“ï¼ˆgrid/list ä¸¤æ¨¡å¼ï¼‰ã€‚
  - é˜²æŠ–/èŠ‚æµï¼ˆ100â€“200msï¼‰ã€åˆ†å—æ¸²æŸ“ã€`requestIdleCallback` ä½ä¼˜é¢„è®¡ç®—ã€‚
  - favicon/å…ƒæ•°æ®ç¼“å­˜ï¼ˆ`chrome.storage` + TTLï¼‰ã€‚
  - æ€§èƒ½åŸ‹ç‚¹ï¼šé¦–å±æ¸²æŸ“ã€è¾“å…¥å»¶è¿Ÿã€å†…å­˜ï¼ˆå¯å¼€å…³è°ƒè¯•æ—¥å¿—ï¼‰ã€‚
- å—å½±å“æ–‡ä»¶
  - `pages/newtab/newtab.js`
  - `modules/visualizationService.js`
- æŒ‡æ ‡
  - é¦–å± < 800msï¼ˆ1k ä¹¦ç­¾åŸºå‡†ï¼‰ã€‚
  - æœç´¢/åˆ‡æ¢ < 100ms å¹³å‡è¾“å…¥å»¶è¿Ÿã€‚
  - 5k ä¹¦ç­¾ç¨³å®šå†…å­˜ < 150MBã€‚

---

## M4 è®¾ç½®ã€ç¬”è®°ä¸å¯ç”¨æ€§æ‰“ç£¨
ç›®æ ‡ï¼šå®Œå–„å¸¸ç”¨åŠŸèƒ½ä¸å¯è®¿é—®æ€§ã€‚

- ä»»åŠ¡
  - ç¬”è®°ä½“éªŒï¼šèŠ‚æµä¿å­˜ã€çŠ¶æ€æç¤ºï¼ˆå·²ä¿å­˜/å¤±è´¥ï¼‰ã€‚
  - è®¾ç½®æŒä¹…åŒ–ï¼šä¸»é¢˜/å¸ƒå±€/æœ€åè®¿é—®æ–‡ä»¶å¤¹ï¼ˆ`chrome.storage.local`ï¼‰ã€‚
  - å¯è®¿é—®æ€§ï¼šé”®ç›˜å¯¼èˆªã€ARIA æ ‡æ³¨ã€ç„¦ç‚¹æ ·å¼ã€‚
  - ç»Ÿä¸€ç©º/é”™çŠ¶æ€æ ·å¼ä¸æ–‡æ¡ˆã€‚
- å—å½±å“æ–‡ä»¶
  - `pages/newtab/newtab.js`
  - `pages/newtab/newtab.css`
  - å¯èƒ½å¤ç”¨ `settings-manager.js`
- éªŒæ”¶æ ‡å‡†
  - è®¾ç½®å¯ä¿å­˜/æ¢å¤ã€‚
  - é”®ç›˜å¯æ“ä½œä¸»è¦è·¯å¾„ã€‚
  - æ˜ç¡®çš„ç©º/é”™åé¦ˆã€‚

---

## M5 æµ‹è¯•ã€ç°åº¦ä¸å‘å¸ƒ
ç›®æ ‡ï¼šå¯å‘å¸ƒå¹¶å¯å›æ»šã€‚

- ä»»åŠ¡
  - E2E æ‰‹åŠ¨æ¸…å•ï¼š
    - æ–°æ ‡ç­¾é¡µåŠ è½½ã€æ–‡ä»¶å¤¹å¯¼èˆªã€æœç´¢ã€è§†å›¾åˆ‡æ¢ã€ç¬”è®°ä¿å­˜/åŠ è½½ã€‚
    - Import/Exportã€å»é‡ã€API æµ‹è¯•ï¼ˆåœ¨ `options.html` ä¸­ï¼‰ã€‚
  - `options.html` å¢åŠ â€œå¯ç”¨æ–° Nextab UIâ€ç°åº¦å¼€å…³ï¼ˆå¦‚éœ€ï¼‰ã€‚
  - éšç§å®¡è®¡ï¼šç¦æ­¢é¡µé¢åˆå§‹åŒ–å¤–éƒ¨è¯·æ±‚ï¼ˆå­—ä½“/å›¾æ ‡ï¼‰ã€‚
  - å›æ»šç­–ç•¥ï¼šä¿ç•™æ—§é¡µï¼Œå¿…è¦æ—¶æ”¹å› `manifest.json` æŒ‡å‘ã€‚
- å—å½±å“æ–‡ä»¶
  - `options.html`ã€`options.js`
  - `manifest.json`
- éªŒæ”¶æ ‡å‡†
  - æ¸…å•é€šè¿‡ã€æ— å¤–è”ã€ä¸€é”®å›æ»šå¯ç”¨ã€‚

---

## é£é™©ä¸å¯¹ç­–
- DOM æ¸²æŸ“å¼€é”€å¤§ â†’ è™šæ‹ŸåŒ– + åˆ†å¸§ + æƒ°æ€§åŠ è½½ã€‚
- CSP è¿è§„ â†’ å…¨éƒ¨ä½¿ç”¨æœ¬åœ°è„šæœ¬æ ·å¼ï¼Œç¦å†…è”ä¸è¿œç¨‹å­—ä½“ã€‚
- æ¨¡å—å‰¯ä½œç”¨ â†’ æœåŠ¡å±‚ä¸è§¦ DOMã€ä¸å†™å…¨å±€ã€‚

---

## å½“å‰çŠ¶æ€
- âœ… M1: è„šæ‰‹æ¶ä¸CSPåˆè§„è®¾ç½® (å·²å®Œæˆ)
- âœ… M2: æ•°æ®æ¥å…¥ä¸åŠŸèƒ½æ‰“é€š (å·²å®Œæˆ)
- âœ… M3: è§†å›¾å®Œå–„ä¸æ€§èƒ½ä¼˜åŒ– (å·²å®Œæˆ)
- âœ… M4: è®¾ç½®ã€ç¬”è®°ä¸å¯ç”¨æ€§æ‰“ç£¨ (å·²å®Œæˆ)
- âœ… M5: æµ‹è¯•ã€ç°åº¦ä¸å‘å¸ƒ (å·²å®Œæˆ)
- âœ… M6: åŸºç¡€é«˜çº§åŠŸèƒ½ (å·²å®Œæˆ)

## åŠŸèƒ½æ•´åˆé˜¶æ®µ (åŸºäºå·²æœ‰åŠŸèƒ½)
æ ¹æ® `åŠŸèƒ½æ•´åˆ.md`ï¼Œä»¥ä¸‹åŠŸèƒ½å·²ç»å¼€å‘å®Œæˆï¼Œéœ€è¦æ•´åˆåˆ°æ–°æ ‡ç­¾é¡µï¼š

### ğŸ”„ ç¬¬ä¸€é˜¶æ®µï¼šæ ¸å¿ƒåŠŸèƒ½æ•´åˆ (é«˜ä¼˜å…ˆçº§)
- â³ **AIæ™ºèƒ½åˆ†æåŠŸèƒ½æ•´åˆ**
  - æ™ºèƒ½åˆ†ç±»ç®—æ³•
  - åˆ†ææ—¥å¿—ä¸ç»“æœå±•ç¤º
  - åˆ†ç±»å»ºè®®ä¸æ‰¹é‡å¤„ç†
  - å¯¼å‡ºCSVåŠŸèƒ½
  - å†å²ç‰ˆæœ¬ç®¡ç†

- â³ **ä¹¦ç­¾ç®¡ç†å™¨åŠŸèƒ½æ•´åˆ**
  - æ‰¹é‡å¢åˆ æŸ¥æ”¹ä¹¦ç­¾
  - é‡å¤ä¹¦ç­¾æ£€æµ‹ä¸æ¸…ç†
  - å¤±æ•ˆä¹¦ç­¾æ£€æµ‹ä¸æ¸…ç†
  - ç©ºæ–‡ä»¶å¤¹æ£€æµ‹ä¸æ¸…ç†
  - å¤šçº§æ–‡ä»¶å¤¹å±•å¼€/æŠ˜å 

### ğŸ”„ ç¬¬äºŒé˜¶æ®µï¼šæ•°æ®ç®¡ç†æ•´åˆ (ä¸­ä¼˜å…ˆçº§)
- â³ **æ•°æ®å¯è§†åŒ–åŠŸèƒ½**
  - è¯äº‘å±•ç¤º (åŸºäºæ ‡é¢˜å’Œåˆ†ç±»)
  - æ ‘çŠ¶å›¾å±•ç¤º (æ–‡ä»¶å¤¹ç»“æ„)
  - ç»Ÿè®¡å›¾è¡¨ (é¥¼å›¾ã€æŸ±çŠ¶å›¾ã€æŠ˜çº¿å›¾)
  - å®æ—¶æ•°æ®æ›´æ–°

- â³ **å¯¼å…¥å¯¼å‡ºåŠŸèƒ½**
  - å¤šæ ¼å¼æ”¯æŒ (HTML/JSON/CSV)
  - å¤‡ä»½ä¸æ¢å¤åŠŸèƒ½
  - æ‰¹é‡å¯¼å…¥å¯¼å‡º
  - å†²çªå¤„ç†æœºåˆ¶

### ğŸ”„ ç¬¬ä¸‰é˜¶æ®µï¼šUI/UXç»Ÿä¸€ (ä¸­ä¼˜å…ˆçº§)
- â³ **æ¯›ç»ç’ƒé£æ ¼ç»Ÿä¸€**
  - å‚è€ƒ options.html é¡µé¢æ ·å¼
  - èƒŒæ™¯æ¨¡ç³Šæ•ˆæœä¸åŠé€æ˜å¡ç‰‡
  - æ¸å˜è‰²å½©æ­é…ä¸é˜´å½±å±‚æ¬¡
  - ç»Ÿä¸€ç»„ä»¶åº“

- â³ **ä¸»é¢˜å®šåˆ¶ç³»ç»Ÿå®Œå–„**
  - æ·±è‰²/æµ…è‰²/è‡ªåŠ¨ä¸»é¢˜
  - å¤šç§ä¸»é¢˜è‰²é€‰æ‹©
  - ä¸ªæ€§åŒ–å¸ƒå±€è®¾ç½®
  - ç”¨æˆ·åå¥½ä¿å­˜

### ğŸ”„ ç¬¬å››é˜¶æ®µï¼šä½“éªŒä¼˜åŒ– (ä½ä¼˜å…ˆçº§)
- â³ **äº¤äº’é€»è¾‘ä¼˜åŒ–**
  - åŠ¨ç”»æ•ˆæœæ·»åŠ 
  - æ“ä½œæµç¨‹ä¼˜åŒ–
  - å¿«æ·é”®æ”¯æŒ
  - é”™è¯¯å¤„ç†å®Œå–„

---

## ä¸‹ä¸€æ­¥ï¼ˆç«‹å³æ‰§è¡Œï¼‰
- åœ¨ `pages/newtab/newtab.js` ä¸­æ¥å…¥ `bookmarkService` ä¸ `visualizationService`ï¼š
  - æ¸²æŸ“ `#folder-list` ä¸ `#bookmarks-grid`ã€‚
  - å®ç°æœç´¢ä¸æ–‡ä»¶å¤¹è¿‡æ»¤ã€‚
  - è®¢é˜…ä¹¦ç­¾å˜æ›´å¹¶æ›´æ–° UIã€‚