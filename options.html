<!DOCTYPE html>
<html lang="zh-CN" data-theme="light">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>书签助手 - 设置</title>
  <link rel="icon" type="image/svg+xml" href="images/icon.svg">
  <link rel="stylesheet" href="styles/apple-design-system.css">
  <style>
    body {
      padding: var(--apple-space-8);
    }

    .container {
      max-width: 640px;
      margin: 0 auto;
    }

    /* Header */
    .options-header {
      display: flex;
      align-items: center;
      gap: var(--apple-space-4);
      margin-bottom: var(--apple-space-8);
      padding-bottom: var(--apple-space-6);
      border-bottom: 1px solid var(--apple-divider);
    }

    .options-logo {
      width: 40px;
      height: 40px;
      border-radius: var(--apple-radius-md);
    }

    .options-title {
      font-size: 28px;
      font-weight: 700;
      color: var(--apple-text);
      letter-spacing: -0.5px;
    }

    /* Sections */
    .options-section {
      margin-bottom: var(--apple-space-8);
    }

    .options-section-header {
      display: flex;
      align-items: center;
      gap: var(--apple-space-2);
      margin-bottom: var(--apple-space-4);
    }

    .options-section-title {
      font-size: 20px;
      font-weight: 600;
      color: var(--apple-text);
    }

    .options-section-desc {
      font-size: 13px;
      color: var(--apple-text-secondary);
      margin-bottom: var(--apple-space-5);
      line-height: 1.5;
    }

    /* Form groups */
    .form-group {
      margin-bottom: var(--apple-space-5);
    }

    .form-group label {
      display: block;
      font-size: 13px;
      font-weight: 600;
      color: var(--apple-text-secondary);
      margin-bottom: var(--apple-space-2);
    }

    .form-group input,
    .form-group select {
      width: 100%;
      padding: 10px 14px;
      font-size: 14px;
      font-family: var(--apple-font);
      color: var(--apple-text);
      background: var(--apple-bg-tertiary);
      border: 1px solid var(--apple-border);
      border-radius: var(--apple-radius-sm);
      outline: none;
      transition: all var(--apple-duration-fast) var(--apple-ease);
    }

    .form-group input:focus,
    .form-group select:focus {
      border-color: var(--apple-accent);
      box-shadow: var(--apple-shadow-glow);
    }

    .form-group input::placeholder {
      color: var(--apple-text-tertiary);
    }

    .form-group select {
      appearance: none;
      background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' viewBox='0 0 24 24' fill='none' stroke='%23888' stroke-width='2.5'%3E%3Cpolyline points='6,9 12,15 18,9'%3E%3C/polyline%3E%3C/svg%3E");
      background-repeat: no-repeat;
      background-position: right 12px center;
      padding-right: 36px;
    }

    .info-text {
      font-size: 12px;
      color: var(--apple-text-tertiary);
      margin-top: var(--apple-space-2);
      line-height: 1.5;
    }

    .api-info {
      font-size: 12px;
      color: var(--apple-text-secondary);
      margin-top: var(--apple-space-2);
    }

    .api-link {
      color: var(--apple-accent);
      text-decoration: none;
    }

    .api-link:hover {
      text-decoration: underline;
    }

    /* Buttons */
    button {
      display: inline-flex;
      align-items: center;
      gap: var(--apple-space-2);
      padding: 10px 20px;
      font-size: 14px;
      font-weight: 500;
      font-family: var(--apple-font);
      border: none;
      border-radius: var(--apple-radius-sm);
      cursor: pointer;
      transition: all var(--apple-duration-fast) var(--apple-ease);
      margin-right: var(--apple-space-2);
      margin-bottom: var(--apple-space-2);
    }

    button:active {
      transform: scale(0.97);
    }

    #save-settings,
    #save-category-settings {
      background: var(--apple-accent);
      color: #ffffff;
    }

    #save-settings:hover,
    #save-category-settings:hover {
      background: var(--apple-accent-hover);
    }

    #test-api,
    #test-custom-api {
      background: var(--apple-bg-tertiary);
      color: var(--apple-text);
      border: 1px solid var(--apple-border);
    }

    #test-api:hover,
    #test-custom-api:hover {
      background: var(--apple-bg-hover);
      border-color: var(--apple-border-focus);
    }

    /* Status message */
    .status {
      padding: 12px 16px;
      border-radius: var(--apple-radius-sm);
      font-size: 13px;
      font-weight: 500;
      margin-top: var(--apple-space-4);
      animation: apple-fadeInUp 0.3s var(--apple-ease);
    }

    .status.success {
      background: var(--apple-success-bg);
      color: var(--apple-success);
    }

    .status.error {
      background: var(--apple-danger-bg);
      color: var(--apple-danger);
    }

    /* Toggle debug */
    .toggle-debug {
      font-size: 13px;
      color: var(--apple-accent);
      cursor: pointer;
      font-weight: 500;
      margin-top: var(--apple-space-4);
      display: inline-block;
    }

    .toggle-debug:hover {
      text-decoration: underline;
    }

    /* Debug panel */
    .debug-panel {
      margin-top: var(--apple-space-5);
      padding: var(--apple-space-5);
      background: var(--apple-bg-tertiary);
      border: 1px solid var(--apple-border);
      border-radius: var(--apple-radius-md);
      display: none;
    }

    .debug-panel h3 {
      font-size: 15px;
      font-weight: 600;
      margin-bottom: var(--apple-space-4);
      color: var(--apple-text);
    }

    .debug-panel pre {
      max-height: 200px;
      overflow: auto;
      background: var(--apple-bg);
      padding: var(--apple-space-3);
      border-radius: var(--apple-radius-xs);
      font-size: 11px;
      margin: var(--apple-space-2) 0;
      font-family: 'SF Mono', Monaco, Consolas, monospace;
      color: var(--apple-text);
      border: 1px solid var(--apple-border);
    }

    /* Custom API section */
    .api-section {
      background: var(--apple-bg-tertiary);
      border: 1px solid var(--apple-border);
      border-radius: var(--apple-radius-md);
      padding: var(--apple-space-6);
      margin-top: var(--apple-space-5);
    }

    .form-description {
      background: var(--apple-bg);
      border: 1px solid var(--apple-border);
      padding: var(--apple-space-4);
      border-radius: var(--apple-radius-sm);
      margin-top: var(--apple-space-4);
      font-size: 13px;
      color: var(--apple-text-secondary);
      line-height: 1.6;
    }

    .form-description ul {
      margin: var(--apple-space-2) 0;
      padding-left: 20px;
    }

    .form-description code {
      background: var(--apple-accent-bg);
      padding: 1px 6px;
      border-radius: 4px;
      font-family: 'SF Mono', Monaco, monospace;
      font-size: 12px;
      color: var(--apple-accent);
    }

    /* Cards */
    .options-card {
      background: var(--apple-bg-tertiary);
      border: 1px solid var(--apple-border);
      border-radius: var(--apple-radius-lg);
      padding: var(--apple-space-6);
      box-shadow: var(--apple-shadow-sm);
      margin-bottom: var(--apple-space-6);
    }

    .hidden {
      display: none !important;
    }

    @media (max-width: 768px) {
      body {
        padding: var(--apple-space-5);
      }

      .options-title {
        font-size: 22px;
      }
    }
  </style>
</head>

<body>
  <div class="container">
    <div class="options-header">
      <img src="images/icon.svg" alt="书签助手" class="options-logo">
      <span class="options-title">书签助手 - 设置</span>
    </div>

    <div class="options-card">
      <div class="options-section-header">
        <span class="options-section-title">API 设置</span>
      </div>
      <p class="options-section-desc">选择 AI 服务提供商并配置 API 密钥以启用智能书签分类功能。</p>

      <div class="form-group">
        <label for="api-provider">API 提供商</label>
        <select id="api-provider">
          <option value="gemini">Google Gemini</option>
          <option value="openai">OpenAI</option>
          <option value="custom">自定义</option>
        </select>
      </div>

      <div class="form-group">
        <label for="api-key">API 密钥</label>
        <input type="password" id="api-key" placeholder="请输入 API 密钥">
        <div class="api-info" id="api-gemini-info">
          获取 Gemini API 密钥：<a href="https://aistudio.google.com/apikey" target="_blank" rel="noopener"
            class="api-link">Google AI Studio →</a>
        </div>
        <div class="api-info hidden" id="api-openai-info">
          获取 OpenAI API 密钥：<a href="https://platform.openai.com/api-keys" target="_blank" rel="noopener"
            class="api-link">OpenAI Platform →</a>
        </div>
      </div>

      <div class="form-group" id="gemini-model-field">
        <label for="gemini-model">Gemini 模型</label>
        <select id="gemini-model">
          <option value="gemini-2.0-flash">gemini-2.0-flash</option>
          <option value="gemini-2.5-flash-preview-05-20">Gemini 2.5 Flash 预览版</option>
          <option value="gemini-2.5-pro-preview-06-05">Gemini 2.5 Pro 预览版</option>
        </select>
        <div class="info-text">选择合适的模型版本，不同模型有不同的能力和计费标准</div>
      </div>

      <div class="form-group hidden" id="openai-model-field">
        <label for="openai-model">OpenAI 模型</label>
        <select id="openai-model">
          <option value="gpt-3.5-turbo">gpt-3.5-turbo</option>
          <option value="gpt-4">gpt-4</option>
          <option value="gpt-4-turbo">gpt-4-turbo</option>
        </select>
        <div class="info-text">较高版本效果更好，费用也更高</div>
      </div>

      <div class="form-group hidden" id="custom-model-field">
        <label for="custom-model">自定义模型标识符</label>
        <input type="text" id="custom-model" placeholder="请输入模型标识符">
        <div class="info-text">输入您的 API 服务所需的模型标识符</div>
      </div>

      <div class="form-group hidden" id="custom-api-fields">
        <label for="custom-api-url">自定义 API 端点 URL</label>
        <input type="text" id="custom-api-url" placeholder="请输入 API 端点 URL">
      </div>

      <button id="save-settings">保存设置</button>
      <button id="test-api">测试连接</button>

      <div id="status-message" class="status hidden"></div>

      <div class="toggle-debug" id="toggle-debug">显示调试信息 →</div>

      <div class="debug-panel" id="debug-panel">
        <h3>API 调试信息</h3>
        <div>
          <strong>请求 URL:</strong>
          <pre id="debug-url"></pre>
        </div>
        <div>
          <strong>请求数据:</strong>
          <pre id="debug-request"></pre>
        </div>
        <div>
          <strong>响应数据:</strong>
          <pre id="debug-response"></pre>
        </div>
        <div>
          <strong>错误信息:</strong>
          <pre id="debug-error"></pre>
        </div>
      </div>
    </div>

    <div class="options-card">
      <div class="options-section-header">
        <span class="options-section-title">分类设置</span>
      </div>

      <div class="form-group">
        <label for="default-categories">默认分类（用逗号分隔）</label>
        <input type="text" id="default-categories" placeholder="技术,教育,购物,社交媒体,新闻,娱乐,工作,其他">
        <div class="info-text">设置书签的默认分类标签，AI 会优先使用这些分类</div>
      </div>

      <div class="form-group">
        <label for="batch-size">每批处理书签数量</label>
        <input type="text" id="batch-size" placeholder="50">
        <div class="info-text">当书签数量较多时，系统会自动分批处理。建议设置为 30-100 之间</div>
      </div>

      <button id="save-category-settings">保存分类设置</button>
    </div>

    <div id="custom-api-section" class="api-section" style="display:none;">
      <div class="form-group">
        <label for="custom-api-key">自定义 API 密钥</label>
        <input type="password" id="custom-api-key" placeholder="输入您的自定义 API 密钥">
      </div>
      <div class="form-group">
        <label for="custom-api-url">自定义 API URL</label>
        <input type="text" id="custom-api-url" placeholder="输入您的自定义 API URL">
      </div>
      <div class="form-group">
        <label for="custom-model">模型名称</label>
        <input type="text" id="custom-model" placeholder="输入模型名称">
      </div>
      <button id="test-custom-api">测试自定义 API 连接</button>
      <div class="form-description">
        <p><strong>自定义 API 格式说明：</strong></p>
        <p>使用自定义 API 时，扩展会尝试以多种格式发送请求，支持如下字段：</p>
        <ul>
          <li><code>model</code>: 模型名称</li>
          <li><code>prompt</code>: 提示文本</li>
          <li><code>messages</code>: OpenAI 格式消息数组</li>
          <li><code>content</code>: 内容文本</li>
          <li><code>input</code>: 输入文本</li>
        </ul>
      </div>
    </div>
  </div>

  <script src="styles/icons.js"></script>
  <script src="options.js"></script>
</body>

</html>